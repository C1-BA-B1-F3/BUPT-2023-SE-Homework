```
backend/
|-- app/
|      |-- views/           # ËßÜÂõæÂáΩÊï∞
|          |-- auth.py      # ÂåÖÂê´ÁôªÂΩïÂíåÊ≥®ÈîÄÁöÑËßÜÂõæÂáΩÊï∞
|          |-- admin.py     # ÂåÖÂê´ËÆæÂ§áÁÆ°ÁêÜÁõ∏ÂÖ≥ÁöÑËßÜÂõæÂáΩÊï∞
|          |-- control.py   # Â§ÑÁêÜÂÆ¢Êà∑Á´ØÊéßÂà∂Êìç‰Ωú
|          |-- client.py    # Â§ÑÁêÜÊúâÂÖ≥ÂÆ¢Êà∑Á´Ø
|          |-- billing.py   # ÁîüÊàêË¥¶ÂçïÂíåËØ¶ÂçïÁöÑËßÜÂõæÂáΩÊï∞
|          |-- query.py     # ÂåÖÂê´Êï∞ÊçÆÊü•ËØ¢Áõ∏ÂÖ≥ÁöÑËßÜÂõæÂáΩÊï∞
|          |-- room.py      # ÂåÖÂê´ÊàøÈó¥Áõ∏ÂÖ≥ÁöÑËßÜÂõæÂáΩÊï∞
|      |-- config.py        # ÈÖçÁΩÆÊñá‰ª∂
|      |-- run.py           # ÊûÑÂª∫ÂÆû‰æã
|      |-- models.py        # Êï∞ÊçÆÂ∫ìÊ®°Âûã
|      |-- utils.py         # Â≠òÂÇ®ËæÖÂä©ÂáΩÊï∞ÂíåÂ∑•ÂÖ∑ÂáΩÊï∞
|-- data/
|      |-- buptse.db        # Sqlite Êï∞ÊçÆÂ∫ì
|-- cli.py          		# ËøêË°åÊñá‰ª∂
```
## ÂêéÁ´ØÈÉ®ÂàÜ‰∫§‰∫í‰ΩøÁî®ËØ¥ÊòéÊñáÊ°£

> Written by @Conqueror712 ü§ó

Ë¶ÅÊµãËØïrouteÊòØÂê¶ÂèØÁî®Ôºå‰ª•‰æøËøõË°å‰∏ã‰∏ÄÊ≠•ÁöÑÂºÄÂèë‰∏é‰ΩøÁî®ÔºåËØ∑Á°Æ‰øùÊã•Êúâ‰ª•‰∏ãÊµãËØïÁéØÂ¢ÉÔºö

> Ê≥®ÔºöÂπ∂Èùû‰∏ÄÂÆöË¶ÅÁî®Ëøô‰∫õÁéØÂ¢ÉÊâçËÉΩËøõË°åÊµãËØïÔºå‰ªÖ‰æõÂèÇËÄÉ

- OS: Windows 10/11
- APIÊµãËØïÂ∑•ÂÖ∑: Apifox/Postman
- PythonÁéØÂ¢É: requirements.txt‰∏≠ÊâÄÈúÄÁöÑÊâÄÊúâÁ¨¨‰∏âÊñπÂ∫ì
- Project src: git clone git@github.com:Cloud0310/BUPT-2023-SE-Homework.git
- DBMS: SQLite

### 1. ÊâìÂºÄSQLiteÂπ∂ÂàõÂª∫Êï∞ÊçÆÂ∫ì

ËØ∑Á°Æ‰øù‰Ω†Ê≠£Á°ÆÂÆâË£Ö‰∫ÜSQLiteÂπ∂Ê∑ªÂä†‰∫ÜÁõ∏Â∫îÁöÑÁéØÂ¢ÉÂèòÈáèÔºåÈöèÂêéÊâìÂºÄ‰∏Ä‰∏™PowerShellËæìÂÖ•ÂëΩ‰ª§‰ª•ÊâìÂºÄSQLite:

```
sqlite3
```

ÂèØ‰ª•‰ΩøÁî®‰ª•‰∏ãÊñπÊ≥ïÂàõÂª∫‰∏Ä‰∏™Êï∞ÊçÆÂ∫ìÔºàÊñπÊ≥ï‰∏çÂîØ‰∏ÄÔºåËøôÁßçÊñπÊ≥ïÂ¶ÇÊûú`xxx.db`Â≠òÂú®ÂàôÁõ¥Êé•‰ºöÊâìÂºÄÔºå‰∏çÂ≠òÂú®Â∞±ÂàõÂª∫ÂÆÉÔºâ:

```
sqlite>.open buptse.db
```

> Ê≥®ÊÑèÔºåËøôÊù°ÂëΩ‰ª§ÂâçÈù¢ÁöÑ`sqlite>`‰∏çÈúÄË¶ÅÊàë‰ª¨ËæìÂÖ•ÔºåÂè¶Â§ñÔºåËøô‰ºöÂú®ÂΩìÂâçÁõÆÂΩï‰∏ãÂàõÂª∫ÔºåËØ∑Á°Æ‰øù‰Ω†ÁöÑË∑ØÂæÑÊ≠£Á°ÆÔºåÂú®Êú¨È°πÁõÆ‰∏≠ÔºåÈªòËÆ§Âú®Áõ∏ÂØπË∑ØÂæÑ`/backend/db/`‰∏ã

‰Ω†ÂèØ‰ª•‰ΩøÁî®‰ª•‰∏ãÊåá‰ª§Êù•Êü•ÁúãÊòØÂê¶ÊàêÂäüÂàõÂª∫ÔºåÂΩìÁÑ∂‰πüÂèØ‰ª•Âú®Êñá‰ª∂Â§π‰∏≠Áõ¥Êé•Êü•Áúã:

```
>sqlite>.databases
```

Âè¶Â§ñÔºåÂ¶ÇÊûú‰Ω†ÂèëÁé∞‰Ω†ÁöÑterminal‰∏≠ÁöÑËæìÂá∫Âπ∂‰∏çÁõ¥ËßÇÔºåÂèØ‰ª•‰ΩøÁî®‰ª•‰∏ãÂëΩ‰ª§Êù•ÂºÄÂêØÊ†ºÂºèÂåñËæìÂá∫:

```
sqlite>.header on
sqlite>.mode column
sqlite>.timer on
```

ÂèØ‰ª•‰ΩøÁî®‰ª•‰∏ãÂëΩ‰ª§Êù•Êü•Áúã‰Ω†ÁöÑSQLiteÈÖçÁΩÆ:

```
sqlite>.show
```

Â¶ÇÊûú‰Ω†ÂÄ¶‰∫ÜÔºåÈÇ£‰πàÂèØ‰ª•‰ΩøÁî®‰ª•‰∏ãÂëΩ‰ª§Êù•ÈÄÄÂá∫SQLiteÔºåËØ∑Â∞ΩÈáè‰∏çË¶ÅÊö¥ÂäõÈÄÄÂá∫:

```
sqlite>.quit
```

ÂΩì‰Ω†ÊÉ≥ÂØºÂá∫ÂÆåÊï¥ÁöÑ`.sql`Êñá‰ª∂ÁöÑÊó∂ÂÄôÔºåÂèØ‰ª•‰ΩøÁî®Â¶Ç‰∏ãÂëΩ‰ª§:

```
sqlite3 xxx.db .dump > xxx.sql
```

ÂΩìÁÑ∂Ôºå‰πüÂèØ‰ª•Áî±`.sql`ÊÅ¢Â§çÊàê`.db`:

```
sqlite3 xxx.db < xxx.sql
```

> Ê≥®ÔºöËøôÈáåÂØºÂá∫ÁöÑ`.sql`Êñá‰ª∂ÁöÑÁºñÁ†ÅÊ†ºÂºè‰∏∫ASCII

### 2. ÂàùÂßãÂåñÊï∞ÊçÆÂ∫ìÈÖçÁΩÆ

> Ê≥®ÔºöËøôÈáåÁöÑË°®ÁªìÊûÑ‰∏ç‰∏ÄÂÆöÊòØÊúÄÁªàÁâàÁöÑË°®ÁªìÊûÑÔºåÂè™ÊòØ‰∏∫‰∫Ü‰æø‰∫éËøõË°åÊµãËØï

È¶ñÂÖàÂΩìÁÑ∂ÊòØË¶ÅÊòéÁ°ÆÊàë‰ª¨ÈúÄË¶ÅÂá†Âº†Ë°®ÔºåÊØèÂº†Ë°®ÈáåÊúâ‰ªÄ‰πàÔºå‰æãÂ¶Ç:

- DevicesË°®Ôºö
    - roomÔºöTEXTÁ±ªÂûãÔºåË°®Á§∫ÊàøÈó¥Âè∑
    - public_keyÔºöTEXTÁ±ªÂûãÔºåË°®Á§∫ËÆæÂ§áÁöÑÂÖ¨Èí•
        check_insË°®Ôºö
    - roomÔºöTEXTÁ±ªÂûãÔºåË°®Á§∫ÊàøÈó¥Âè∑
    - check_in_timeÔºöÂ≠òÂÇ®ÂÖ•‰ΩèÊó∂Èó¥ÁöÑÂ≠óÊÆµÔºåÂÖ∑‰ΩìÁ±ªÂûãÂèñÂÜ≥‰∫é‰Ω†Â∏åÊúõ‰ΩøÁî®ÁöÑÊó∂Èó¥Ë°®Á§∫ÊñπÂºè
    - check_out_timeÔºöÂ≠òÂÇ®ÈÄÄÊàøÊó∂Èó¥ÁöÑÂ≠óÊÆµÔºåÂÖ∑‰ΩìÁ±ªÂûãÂèñÂÜ≥‰∫é‰Ω†Â∏åÊúõ‰ΩøÁî®ÁöÑÊó∂Èó¥Ë°®Á§∫ÊñπÂºè
    - timestampÔºöÂ≠òÂÇ®Êó∂Èó¥Êà≥ÁöÑÂ≠óÊÆµÔºåÁî®‰∫éËÆ∞ÂΩïÊìç‰ΩúÂèëÁîüÁöÑÊó∂Èó¥

ÊòéÁ°Æ‰∫ÜÈúÄÊ±ÇÔºåÁé∞Âú®Êàë‰ª¨Â∞±Êù•ÁùÄÊâãÂàõÂª∫‰∏Ä‰∏ãÔºå`CREATE TABLE`ËØ≠Âè•ÁöÑÂü∫Êú¨ËØ≠Ê≥ïÂ¶Ç‰∏ã:

```
CREATE TABLE database_name.table_name(
   column1 datatype  PRIMARY KEY(one or more columns),
   column2 datatype,
   column3 datatype,
   .....
   columnN datatype,
);
```

> Ê≥®Ôºö`database_name`Âú®‰Ω†ÈÄâÂÆöÂ•ΩÊï∞ÊçÆÂ∫ìÁöÑÊó∂ÂÄôÂèØ‰ª•ÁúÅÁï•

ÂØπ‰∫éÊàë‰ª¨ÁöÑÈ°πÁõÆËÄåË®ÄÔºåÂèØ‰ª•ÂàõÂª∫ËøôÊ†∑ÁöÑË°®ÔºàËôΩÁÑ∂Â§ßÂ∞èÂÜô‰∏çÊïèÊÑüÔºå‰ΩÜËøòÊòØÂå∫ÂàÜ‰∏∫Â•ΩÔºâ:

```
sqlite> CREATE TABLE records(
   id INT PRIMARY KEY     NOT NULL,
   room           TEXT    NOT NULL
);
```

> Ê≥®Ôºö`NOT NULL`ÁöÑÁ∫¶ÊùüË°®Á§∫Âú®Ë°®‰∏≠ÂàõÂª∫Á∫™ÂΩïÊó∂Ëøô‰∫õÂ≠óÊÆµ‰∏çËÉΩ‰∏∫`NULL`

‰Ω†ÂèØ‰ª•‰ΩøÁî®‰ª•‰∏ãÂëΩ‰ª§Êù•Êü•ÁúãË°®ÊòØÂê¶Ë¢´ÊàêÂäüÂàõÂª∫:

```
sqlite>.tables
```

Êõ¥Ëøõ‰∏ÄÊ≠•Âú∞Ôºå‰Ω†ÂèØ‰ª•‰ΩøÁî®‰ª•‰∏ãÂëΩ‰ª§ÂæóÂà∞Ë°®ÁöÑÂÆåÊï¥‰ø°ÊÅØ:

```
sqlite>.schema table_name
```

![image](/img/1.png)

### 3. ÂÆåÊï¥ÁöÑÂàõÂª∫Ë°®ÂëΩ‰ª§

```
sqlite> CREATE TABLE Users(
   username TEXT PRIMARY KEY NOT NULL,
   role TEXT NOT NULL
);

sqlite> CREATE TABLE Devices(
   room TEXT PRIMARY KEY NOT NULL,
   public_key TEXT NOT NULL
);

sqlite> CREATE TABLE RoomStatus(
   room TEXT PRIMARY KEY NOT NULL,
   temperature INT NOT NULL,
   wind_speed INT NOT NULL,
   mode TEXT NOT NULL,
   sweep BOOLEAN NOT NULL,
   is_on BOOLEAN NOT NULL,
   last_update TEXT NOT NULL
);

sqlite> CREATE TABLE Reports(
   room TEXT NOT NULL,
   start_time TEXT NOT NULL,
   end_time TEXT NOT NULL,
   temperature INT NOT NULL,
   wind_speed INT NOT NULL,
   mode TEXT NOT NULL,
   sweep BOOLEAN NOT NULL,
   duration INT NOT NULL,
   cost INT NOT NULL,
   PRIMARY KEY (room, start_time),
   FOREIGN KEY (room) REFERENCES RoomStatus(room)
);
```

